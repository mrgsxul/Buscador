<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Catálogo - Buscar por ID</title>

  <!-- Bootstrap CSS (para componentes y botones) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Tailwind Play CDN (rápido para prototipos) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Un poco de estilo extra -->
  <style>
    /* Ajuste pequeño para que Bootstrap y Tailwind convivan mejor */
    .form-control { border-radius: .75rem; }
    .rounded-card { border-radius: 1rem; }
    .fade-in { animation: fadeIn .28s ease both; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: none; } }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-6">

  <div id="root" class="w-full max-w-3xl"></div>

  <!-- React + ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- Babel (solo para desarrollo/prototipo; en producción usa bundler) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- App React en JSX -->
  <script type="text/babel">
    const { useState, useEffect } = React;

    function App() {
      const [id, setId] = useState('');
      const [products, setProducts] = useState(null);
      const [result, setResult] = useState(null);
      const [error, setError] = useState(null);
      const [loading, setLoading] = useState(false);

      // JSON de ejemplo (se usa solo si no se encuentra catalog.json ni se sube otro)
      const sampleProducts = [
        {
          "id": 1,
          "title": "View Post →",
          "link": "https://www.ameede.com/santa-christmas-ornament-e0024545-file-cdr-and-dxf-pdf-free-vector-download-for-laser-cut/",
          "image_url": "https://www.ameede.com/wp-content/uploads/2025/12/Santa-Christmas-Ornament-E0024545-file-cdr-and-dxf-pdf-free-vector-download-for-laser-cut.webp",
          "page_url": "https://www.ameede.com/?s=+Christmas+Ornament+",
          "timestamp": "2025-12-06T04:26:01.941Z"
        },
        {
          "id": 32,
          "title": "Producto demo 32",
          "link": "https://example.com/producto/32",
          "image_url": "https://via.placeholder.com/800x450.png?text=Producto+32",
          "page_url": "https://example.com/?s=32",
          "timestamp": "2025-01-01T00:00:00.000Z"
        }
      ];

      // Intentar cargar catalog.json automáticamente (si existe junto al HTML)
      useEffect(() => {
        const fetchCatalog = async () => {
          setLoading(true);
          try {
            const resp = await fetch('./catalog.json', {cache: "no-store"});
            if (!resp.ok) throw new Error('No se encontró catalog.json (ok: false)');
            const json = await resp.json();
            if (json.products && Array.isArray(json.products)) {
              setProducts(json.products);
            } else {
              console.warn('catalog.json no contiene "products". Usando ejemplo.');
              setProducts(sampleProducts);
            }
          } catch (e) {
            // Si falla (no existe o CORS), usar el ejemplo
            console.warn('catalog.json no cargado:', e.message);
            setProducts(sampleProducts);
          } finally {
            setLoading(false);
          }
        };

        fetchCatalog();
      }, []);

      // Buscar por ID
      const buscar = () => {
        setError(null);
        setResult(null);

        const n = parseInt(id);
        if (isNaN(n)) {
          setError('Ingresa un número válido.');
          return;
        }
        if (!products) {
          setError('Catálogo no cargado todavía.');
          return;
        }

        const found = products.find(p => Number(p.id) === n);
        if (!found) {
          setError('No existe un producto con ese ID.');
          return;
        }
        setResult(found);
      };

      // Permitir subir un JSON (arrastrar o seleccionar)
      const handleFile = (file) => {
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (ev) => {
          try {
            const parsed = JSON.parse(ev.target.result);
            if (parsed.products && Array.isArray(parsed.products)) {
              setProducts(parsed.products);
              setError(null);
              setResult(null);
              alert('JSON cargado correctamente.');
            } else {
              alert('El JSON no contiene el arreglo "products".');
            }
          } catch (err) {
            alert('Error al leer JSON: ' + err.message);
          }
        };
        reader.readAsText(file, 'utf-8');
      };

      return (
        <div className="bg-white rounded-card shadow-2xl p-6 md:p-10 border border-gray-200">
          <div className="d-flex justify-content-between align-items-center mb-4">
            <h1 className="text-2xl md:text-3xl fw-bold">Catálogo — Buscar por ID</h1>
            <div className="text-sm text-muted">React · Tailwind · Bootstrap</div>
          </div>

          <p className="text-sm text-gray-600 mb-4">
            Escribe el ID y presiona <strong>Buscar</strong>. El HTML tratará de cargar <code>catalog.json</code> (misma carpeta) si existe.
          </p>

          <div className="row g-3 align-items-center mb-3">
            <div className="col-8">
              <input
                type="text"
                className="form-control p-3"
                placeholder="Ej. 1"
                value={id}
                onChange={e => setId(e.target.value)}
                onKeyDown={e => { if (e.key === 'Enter') buscar(); }}
              />
            </div>
            <div className="col-4 d-grid">
              <button className="btn btn-primary py-2" onClick={buscar}>Buscar</button>
            </div>
          </div>

          <div className="mb-4 d-flex gap-2 flex-wrap">
            <label className="btn btn-outline-secondary btn-sm mb-0">
              Subir JSON
              <input type="file" accept=".json" style={{ display: 'none' }} onChange={e => handleFile(e.target.files[0])} />
            </label>

            <button
              className="btn btn-outline-info btn-sm"
              onClick={() => {
                // Abrir ejemplo de catalog.json en nueva pestaña (data url)
                const sample = JSON.stringify({ products: sampleProducts }, null, 2);
                const blob = new Blob([sample], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'catalog.sample.json';
                a.click();
                URL.revokeObjectURL(url);
              }}
            >
              Descargar JSON ejemplo
            </button>

            <div className="ms-auto text-muted small align-self-center">
              {loading ? 'Cargando catálogo...' : `Productos: ${products ? products.length : '—'}`}
            </div>
          </div>

          {error && (
            <div className="alert alert-danger py-2 fade-in">{error}</div>
          )}

          {result && (
            <div className="card mt-3 fade-in" style={{ overflow: 'hidden' }}>
              {result.image_url && (
                <img src={result.image_url} alt={result.title || 'producto'} className="w-100" style={{ maxHeight: 360, objectFit: 'cover' }} />
              )}
              <div className="card-body">
                <h5 className="card-title mb-2">{result.title || `ID ${result.id}`}</h5>
                <p className="card-text small text-muted mb-2">ID: {result.id} • {result.timestamp ? new Date(result.timestamp).toLocaleString() : ''}</p>

                <div className="d-grid gap-2 d-md-flex">
                  <a className="btn btn-primary" href={result.link} target="_blank" rel="noopener noreferrer">Abrir link</a>
                  {result.page_url && <a className="btn btn-outline-secondary" href={result.page_url} target="_blank" rel="noopener noreferrer">Ver página</a>}
                </div>
              </div>
            </div>
          )}

          {/* Si no hay resultado, mostrar una tabla pequeña de ejemplo (opcional) */}
          {!result && products && (
            <div className="mt-4">
              <div className="small text-muted mb-2">Primeros productos (ejemplo):</div>
              <div className="table-responsive">
                <table className="table table-sm">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Título</th>
                      <th>Link</th>
                    </tr>
                  </thead>
                  <tbody>
                    {products.slice(0, 8).map(p => (
                      <tr key={p.id}>
                        <td>{p.id}</td>
                        <td style={{ maxWidth: 320, overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>{p.title}</td>
                        <td style={{ maxWidth: 280, overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>
                          <a href={p.link} target="_blank" rel="noopener noreferrer">{p.link}</a>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            </div>
          )}

        </div>
      );
    }

    // Render
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>

</body>
</html>
